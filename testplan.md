# Test Plan: SwiftGuard

## 1. Introduction
This document outlines the testing strategy for **SwiftGuard**, an LLM-driven contract testing framework for SWIFT microservices. The objective is to validate that the microservice correctly handles MT103 financial messages by adhering to strict schema contracts, using generative AI for robust data fuzzing.

## 2. Scope
*   **Component**: `swiftService.js` (HTTP Microservice).
*   **Data Format**: SWIFT MT103 (Single Customer Credit Transfer).
*   **Validation Logic**: `parser/swiftParser.js` and `contracts/mt103.schema.json`.
*   **Integration**: `llm/swiftGenerator.js` (Gemini API).
*   **UI**: `ui/index.html` (Dashboard rendering).

## 3. Test Strategy

### 3.1. Contract Testing
We verify that the API enforces the JSON Schema contract defined in `contracts/mt103.schema.json`.
*   **Strict Mode**: The API must reject any message missing mandatory fields (`:20:`, `:32A:`, etc.).
*   **Format Validation**: Fields must match specific regex patterns (e.g., Currency codes, Dates).

### 3.2. Fuzz Testing (LLM-Driven)
Unlike traditional testing with static datasets, specific test data is **NOT** hardcoded.
*   **Valid Scenarios**: Uses Gemini (`gemini-2.5-flash`) to generate unique, valid MT103 messages on the fly.
*   **Invalid Scenarios**: prompting the LLM to deliberately malform messages (e.g., "omit tag :50K:", "use invalid currency code").
*   **Goal**: Ensure the parser and validator handle non-deterministic input gracefully without crashing.

### 3.3. End-to-End (E2E) Verification
Using **Playwright**, we simulate a complete user/system flow:
1.  Generate data (LLM).
2.  Submit to API (HTTP POST).
3.  Verify API Response (JSON status/errors).
4.  Verify UI Rendering (HTML Dashboard update).

## 4. Test Environment
*   **OS**: Windows (Local).
*   **Runtime**: Node.js v18+.
*   **Framework**: Playwright (`@playwright/test`).
*   **LLM Provider**: Google Gemini API (`@google/genai`).
*   **Service Port**: `1934`.

## 5. Test Scenarios

| ID | Title | Description | Expected Request | Expected Response |
| :--- | :--- | :--- | :--- | :--- |
| **TC001** | **TC001: Validate Valid MT103 Contract (API + UI)** | Verify service accepts a valid MT103 generated by LLM. | Raw MT103 string with all mandatory tags (`:20:`, `:32A:`, `:50K:`, `:59:`, `:71A:`). | `200 OK`, `valid: true`, JSON body contains parsed fields. |
| **TC002** | **TC002: Validate Invalid MT103 Contract (API + UI)** | Verify service rejects an MT103 with missing mandatory tags. | Raw MT103 string missing `:23B:` or `:71A:`. | `400 Bad Request`, `valid: false`, `errors` array lists missing properties. |
| **TC003** | **TC003: Validate Parser Resilience (API + UI)** | Verify parser handles leading/trailing whitespace and envelopes. | MT103 inside `{1:...}` envelope or with newlines. | Correctly parses tags ignoring envelopes/whitespace. |
| **TC004** | **TC004: Validate UI Dashboard Sync (API + UI)** | Verify UI updates when a new message is processed. | Poll `/swift` endpoint. | UI displays the Reference ID, Status (Success/Failed), and Raw Data of the latest message. |
| **TC005** | **TC005: Validate LLM Fallback (API + UI)** | Verify test continuity if LLM API is unavailable/fails. | No API Key / Network Error. | System falls back to static stub data; Tests MUST NOT fail due to LLM outage. |
| **TC006** | **TC006: Validate Field Validation Rules** | Verify strict regex patterns for specific fields (e.g., Date/Currency in `:32A:`). | MT103 with invalid date (`991599`) or currency (`XXZ`). | `400 Bad Request`, `valid: false`, error highlights specific field format mismatch. |
| **TC007** | **TC007: Validate Optional Tags Parsing** | Verify parser correctly handles optional but common tags (e.g., `:70:` Remittance Info). | MT103 containing optional `:70:` tag. | `200 OK`, `valid: true`, optional field appears in parsed JSON data. |
| **TC008** | **TC008: Validate Garbage Input Resilience** | Verify parser does not crash on completely non-SWIFT input (JSON, XML, or Plain Text). | Random string "Hello World" or JSON `{"foo":"bar"}`. | `400 Bad Request`, `valid: false`, returns generic "Invalid SWIFT format" error without crashing. |

## 6. Execution
Run the full suite using the following command:
```bash
npx playwright test
```

## 7. Deliverables
*   **Test Report**: HTML report generated by Playwright (`npx playwright show-report`).
*   **Logs**: Console output detailing LLM generation and API status.
